# Virtual desktop assignments (virtual-desktops plugin stickyrules)
# Note: stickyrule uses vdesk numbers, not raw workspace numbers
stickyrule = class:^(dots-term)$,2
stickyrule = class:^(work-term)$,3
stickyrule = class:^(learn-term)$,8

# Avoid idle for fullscreen apps
windowrule = idle_inhibit fullscreen, match:class .*
windowrule = idle_inhibit fullscreen, match:title .*
windowrule = idle_inhibit fullscreen, match:fullscreen true

# Float rules
# windowrule = float on, match:class (Zoom|onedriver|onedriver-launcher)
# windowrule = float on, match:class xdg-desktop-portal-gtk
windowrule = float on, match:class [Rr]ofi
windowrule = float on, match:class (nwg-look|qt5ct|qt6ct|mpv)
windowrule = float on, match:class (nm-applet|nm-connection-editor|blueman-manager)
windowrule = float on, match:class yad
windowrule = float on, match:class evince
windowrule = float on, match:title (Kvantum Manager)
# windowrule = float on, match:class [Ss]team, match:title ((?![Ss]team).*|[Ss]team [Ss]ettings)
windowrule = float on, match:class org.twosheds.iwgtk
windowrule = float on, match:class iwgtk
windowrule = float on, match:class qalculate-gtk

# Dialogs
windowrule = float on, match:class file_progress
windowrule = float on, match:class confirm
windowrule = float on, match:class dialog
windowrule = float on, match:class download
windowrule = float on, match:class notification
windowrule = float on, match:class error
windowrule = float on, match:class splash
windowrule = float on, match:class confirmreset
windowrule = float on, match:title branchdialog

windowrule = float on, match:title (Open File)(.*)
windowrule = float on, match:title (Select a File)(.*)
windowrule = float on, match:title (Choose wallpaper)(.*)
windowrule = float on, match:title (Open Folder)(.*)
windowrule = float on, match:title (Save As)(.*)
windowrule = float on, match:title (Library)(.*)
windowrule = float on, match:title (File Upload)(.*)

windowrule = border_size 0, match:fullscreen true
windowrule = border_color $flamingo, match:pin true

# Picture-in-a-Picture (PIP) rules
windowrule = opacity 0.95 0.75, match:title (Picture-in-Picture)
windowrule = pin on, match:title (Picture-in-Picture)
windowrule = float on, match:title (Picture-in-Picture)
windowrule = size (monitor_w*0.25) (monitor_h*0.25), match:title (Picture-in-Picture)
windowrule = move (monitor_w*0.72) (monitor_h*0.07), match:title (Picture-in-Picture)

# Polkit
windowrule = float on, match:class hyprpolkitagent
windowrule = pin on, match:class hyprpolkitagent
windowrule = focus_on_activate on, match:class hyprpolkitagent

# Studio One 7 - Fix menu bar positioning (CSD/SSD mismatch)
windowrule = border_size 0, match:class com\.presonus\.studioapp7
windowrule = no_shadow on, match:class com\.presonus\.studioapp7

windowrule = float on, match:class vesktop
windowrule = pin on, match:class vesktop

# browser windows - page info
windowrule = float on, match:class zen|zen-twilight, match:initial_title ^$
windowrule = size 1000 1000, match:class zen|zen-twilight, match:initial_title ^$

# tridactyl
windowrule = float on, match:class term-tridactyl
windowrule = size 1600 1200, match:class term-tridactyl

###############
# Hyprscratch #
###############
$scratchpads = match:initial_class (Slack|wasistlos|com\.github\.th_ch\.youtube_music|org\.pulseaudio\.pavucontrol|com\.github\.wwmm\.easyeffects|Claude|btm-term|nvtop-term|drop-term|spotify|obsidian|linear-linux|Todoist|Proton.Mail)
$scratchpadsTitle = match:initial_title (Open WebUI|reclaim\.ai_/)

# defaults (static rules - applied once at window creation)
windowrule = float on, $scratchpads
# WORKAROUND: Hyprland 0.53.1 regression - monitor_w/monitor_h expressions not evaluated
# Original: size (monitor_w*0.9) (monitor_h*0.9)
# TODO: Revert when fixed upstream (check github.com/hyprwm/Hyprland/issues)
windowrule = size 1920 1200, $scratchpads
windowrule = center on, $scratchpads

windowrule = float on, $scratchpadsTitle
# WORKAROUND: Same as above
# Original: size (monitor_w*0.9) (monitor_h*0.9)
windowrule = size 1920 1200, $scratchpadsTitle
windowrule = center on, $scratchpadsTitle

# Named rules for max_size (can be dynamically disabled for togglefloating)
# Workaround for Hyprland 0.53 bug: https://github.com/hyprwm/Hyprland/discussions/12762
windowrule {
  name = scratchpad-max-size
  match:initial_class = (Slack|wasistlos|com\.github\.th_ch\.youtube_music|org\.pulseaudio\.pavucontrol|com\.github\.wwmm\.easyeffects|Claude|btm-term|nvtop-term|drop-term|spotify|obsidian|linear-linux|Todoist|Proton\.Mail)
  max_size = 1920 1200
}

windowrule {
  name = scratchpad-title-max-size
  match:initial_title = (Open WebUI|reclaim\.ai_/)
  max_size = 1920 1200
}

# overrides
$passRule = match:initial_class 1password
windowrule = float on, $passRule
windowrule = size 1200 900, $passRule
windowrule = center on, $passRule
windowrule = focus_on_activate on, $passRule

windowrule {
  name = 1password-max-size
  match:initial_class = 1password
  max_size = 1200 900
}

# WORKAROUND: Hyprland 0.53.1 regression - monitor_w/monitor_h expressions not evaluated
# Original: size (monitor_w*0.33) (monitor_h*0.66)
windowrule = size 800 600, match:initial_title (Volume Control)

windowrule {
  name = volume-max-size
  match:initial_title = (Volume Control)
  max_size = 800 600
}

# start hidden (autostarted except 1pass)
windowrule = workspace special:Slack silent, match:initial_title Slack
windowrule = workspace special:WasIstLos silent, match:initial_title WasIstLos
